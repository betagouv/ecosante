{% extends 'base.html' %}

{% block content %}


<link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />

<section class="section section-grey">
    <div class="container">
        <div class="panel">
            <h1><span class="number">{{ actifs }}</span> utilisateurs actifs</h1>
            <canvas id="subscriptions_chart"></canvas>
        </div>
        <div class="panel panel-carte">
            <h1>Profil des utilisateurs</h1>
            <div class="row">
                <div>
                    <h2>Provenance géographique des utilisateurs</h2>
                    <div id="carte"></div>
                </div>
                <div class="users-profile">
                    <h3>{{ "%.2f"|format((nb_allergies/nb_inscriptions)*100) }}% des utilisateurs se déclarent allergiques au pollens</h3>
                    <h3>{{ "%.2f"|format((nb_pathologie_respiratoire/nb_inscriptions)*100) }}% des utilisateurs déclarent avoir une pathologie respiratoire</h3>
                </div>
            </div>
        </div>
        <div class="panel user_pref">
            <h1>Préférence des utilisateurs</h1>
            <div>
                <div class="half_donut">
                    <canvas id="user_formats"></canvas>
                </div>
                <div class="half_donut">
                    <canvas id="user_frequencies"></canvas>
                </div>
            </div>
        </div>
        <div class="panel">
            <h1>Satisfaction des utilisateurs</h1>
            <h2>{{ nb_reponses }} réponses aux questionnaires</h2>
            <h3>{{ "%.2f"|format((nb_satisfaits/nb_reponses)*100) }}% des utilisateurs ayant répondu au questionnaire de satisfaction recommanderaient la newsletter Ecosanté à leur proche.</h3>
            <canvas id="decouverte_chart"></canvas>
        </div>
        {% if ouvertures %}
        <div class="panel">
            <h1>Ouverture des mails</h1>
            <h2>{{ "%.2f"|format(ouverture_veille[1]) }}% taux d’ouverture des mails le {{ ouverture_veille[0] }} </h2>
            <canvas id="ouvertures_chart"></canvas>
        </div>
        {% endif %}
    </div>
</section>
{% rollupjs "stats/js/stats.js" %}
<script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
<script id="media" type="application/json">{{ media|safe}}</script>
<script id="frequence" type="application/json">{{ frequence|safe}}</script>
<script id="subscriptions" type="application/json">{{ subscriptions|safe}}</script>
<script id="decouverte" type="application/json">{{ decouverte|safe}}</script>
<script id="ouvertures" type="application/json">{{ ouvertures|safe}}</script>
{% endblock content %}